services:
  auto-triage:
    #build:
    #  context: ../../..
    #  dockerfile: documentation/docs/docker/Dockerfile
    #  args:
    #    USER_ID: ${UID:-1000}
    image: hsuyuanyuan/docker-auto-triage:v0.7  # docker hub
    # Note: once the dockerfile is stable, build the image and push to docker hub
    # (1) docker image list
    # (2) docker tag image-name docker-account/image-name:version
    # (3) docker push docker-account/image-name:version
    volumes:
      # Mount user's directory with read-write access
      - ../../..:/root/workspace
      - root-config:/root/.config # Note: this fixed the issue with missing configs between docker runs
      - root-local:/root/.local # Note: this fixed the missing logs between docker runs
      # Mount git config
      # ~/.gitconfig:/root/.gitconfig:ro   # make it optional
      # Mount SSH keys
      - ~/.ssh:/root/.ssh:ro
      # Mount Docker socket for running GitHub MCP server
      # - /var/run/docker.sock:/var/run/docker.sock
    working_dir: /root/workspace
    environment:
      # Set default editor
      - EDITOR=vim
      # Preserve git author info
      - GIT_AUTHOR_NAME=${GIT_AUTHOR_NAME:-Goose User}
      - GIT_AUTHOR_EMAIL=${GIT_AUTHOR_EMAIL:-goose@example.com}
      # Set GOOGLE_API_KEY to your own API key
      - GOOGLE_API_KEY  # Pass your key in .env file in the same folder as compose.yaml
      - GOOSE_PROVIDER=google
      - GOOSE_MODEL=gemini-2.0-flash-exp
      - DBUS_SESSION_BUS_ADDRESS
      - SSH_AUTH_SOCK
      - GITHUB_PERSONAL_ACCESS_TOKEN
      - AWS_ACCESS_KEY_ID
      - AWS_SECRET_ACCESS_KEY
    stdin_open: true
    tty: true
    entrypoint: ["/bin/bash"] #   #goose  # "/bin/bash"
    # No entrypoint or command override needed here - uses Dockerfile's

volumes:
  root-config:
  root-local:
